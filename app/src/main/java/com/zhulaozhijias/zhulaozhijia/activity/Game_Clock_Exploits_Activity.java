package com.zhulaozhijias.zhulaozhijia.activity;

import android.content.Intent;
import android.graphics.Bitmap;
import android.util.Log;
import android.view.View;
import android.widget.Button;
import android.widget.LinearLayout;
import android.widget.ListView;
import android.widget.ProgressBar;
import android.widget.RelativeLayout;
import android.widget.TextView;

import com.zhulaozhijias.zhulaozhijia.R;
import com.zhulaozhijias.zhulaozhijia.adpter.Game_Exploits_Listview_Adapter;
import com.zhulaozhijias.zhulaozhijia.base.BPApplication;
import com.zhulaozhijias.zhulaozhijia.base.BaseActivity;
import com.zhulaozhijias.zhulaozhijia.base.SystemConstant;
import com.zhulaozhijias.zhulaozhijia.presenter.MainPresenter;
import com.zhulaozhijias.zhulaozhijia.view.MainView;
import com.zhulaozhijias.zhulaozhijia.widgets.CreateMD5;

import net.sf.json.JSONArray;
import net.sf.json.JSONObject;

import java.util.HashMap;
import java.util.Map;

/**
 * Created by asus on 2017/10/19.
 */

public class Game_Clock_Exploits_Activity extends BaseActivity implements View.OnClickListener,MainView{
    private LinearLayout game_exploits_back;
    private ListView game_exploits_listview;
    private MainPresenter mainPresenter;
    private RelativeLayout juanzengjilu_defaults;//缺省页
    private Button game_exploited_lijicanjia;
    private TextView total,success_money,success_number;
    private JSONArray jsonArray2;
    private RelativeLayout rt_exploits;
    private ProgressBar game_clock_progress_bar;
    @Override
    public void addLayout() {
        setContentView(R.layout.game_clock_exploits_activity);
    }

    @Override
    public void initView() {
        mainPresenter=new MainPresenter(this,this);
        game_exploits_back= (LinearLayout) findViewById(R.id.game_exploits_back);
        game_exploits_back.setOnClickListener(this);
        game_exploits_listview= (ListView) findViewById(R.id.game_exploits_listview);
        juanzengjilu_defaults= (RelativeLayout) findViewById(R.id.juanzengjilu_defaults);
        game_exploited_lijicanjia= (Button) findViewById(R.id.game_exploited_lijicanjia);
        game_exploited_lijicanjia.setOnClickListener(this);
        total= (TextView) findViewById(R.id.total);
        success_money= (TextView) findViewById(R.id.success_money);
        success_number= (TextView) findViewById(R.id.success_number);
        game_clock_progress_bar= (ProgressBar) findViewById(R.id.game_clock_progress_bar);
        rt_exploits= (RelativeLayout) findViewById(R.id.rt_exploits);
        rt_exploits.setOnClickListener(this);
        game_clock_progress_bar.setVisibility(View.VISIBLE);
        Map<String ,String >map = new HashMap<>();
        map.put("member_id", BPApplication.getInstance().getMember_Id());
        map.put("secret", CreateMD5.getMd5(BPApplication.getInstance().getMember_Id()+"z!l@z#j$"));
        mainPresenter.postMap(SystemConstant.GAME.Game_EARLY_RECRD,map);
    }

    @Override
    public void onClick(View view) {
        switch (view.getId()){
            case R.id.game_exploits_back:
                finish();
                break;
            case R.id.game_exploited_lijicanjia:
                finish();
                break;
            case R.id.rt_exploits:
                Intent intent = new Intent(Game_Clock_Exploits_Activity.this,Mine_Game_RecordActivity.class);
                startActivity(intent);
                break;
        }
    }

    @Override
    public void getView(String s) {

    }

    @Override
    public void postView(final String s) {
        runOnUiThread(new Runnable() {
            @Override
            public void run() {
                JSONObject jsonObject =JSONObject.fromObject(s);
                jsonArray2=new JSONArray();
                if(jsonObject.getString("success").equals("true")){
                    juanzengjilu_defaults.setVisibility(View.GONE);
                    game_exploits_listview.setVisibility(View.VISIBLE);
                    total.setText(jsonObject.getString("total"));
                    success_money.setText(jsonObject.getString("success_money"));
                    success_number.setText(jsonObject.getString("success_number"));
                    JSONArray jsonArray = JSONArray.fromObject(jsonObject.getString("data"));
                    for (int i =0;i<jsonArray.size();i++){
                        jsonArray2.add(jsonArray.getJSONObject(i));
                    }
                    game_clock_progress_bar.setVisibility(View.GONE);
                    game_exploits_listview.setAdapter(new Game_Exploits_Listview_Adapter(Game_Clock_Exploits_Activity.this,jsonArray2));
                }else {
                    game_clock_progress_bar.setVisibility(View.GONE);
                    juanzengjilu_defaults.setVisibility(View.VISIBLE);
                    game_exploits_listview.setVisibility(View.GONE);

                }
            }
        });
    }

    @Override
    public void postViews(String s) {

    }

    @Override
    public void postViewss(String s) {

    }

    @Override
    public void postViewsss(String s) {

    }

    @Override
    public void postViewsss_1(String s) {

    }

    @Override
    public void postViewsss_2(String s) {

    }

    @Override
    public void fail(String s) {

    }

    @Override
    public void imgView(Bitmap bitmap) {

    }
}
